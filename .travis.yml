language: android
jdk: oraclejdk8

branches:
  only:
    - master
    - /^\d+\.\d+\.\d+$/

before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
cache:
  directories:
    - $HOME/.gradle/caches/modules-2/
    - $HOME/.gradle/wrapper/dists/

android:
  components:
    - tools
    - platform-tools
    - build-tools-28.0.3
    - android-28
    - android-24
    - sys-img-armeabi-v7a-android-24

before_script:
  - echo $ANDROID_HOME
  - export ANDROID_SDK_ROOT=$ANDROID_HOME
  - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a -c 100M
  - emulator -avd test -memory 500 -partition-size 800 -no-accel -gpu swiftshader -camera-back none -camera-front none -no-boot-anim -no-snapstorage -no-window &
  - android-wait-for-emulator
  - adb shell input keyevent 82 &

script: ./gradlew check

deploy:
  - provider: script
    script: ./gradlew publish
    on:
      branch: master
      tags: true
